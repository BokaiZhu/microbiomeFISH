ggplot(c, aes(x=type, y=freq))+
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label = scales::percent(..prop..),
y= ..prop.. ), stat= "count", vjust = -.5)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( y=freg))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( y=freq))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=type,y=freq))
a-b
table(subdf_aft$after_comp_ann.celltype)-table(subdf_before$before_comp_ann.celltype)
temp=table(subdf_aft$after_comp_ann.celltype)-table(subdf_before$before_comp_ann.celltype)
temp=as.data.frame(temp)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq, vjust = -.5))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq, vjust = freq*0.05))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq, vjust = freq*0.5))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = freq)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = freq)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = freq*0.5)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = freq*0.5)
# after %
a=table(subdf_aft$after_comp_ann.celltype)/sum(table(subdf_aft$after_comp_ann.celltype))#-table(subdf_before$before_comp_ann.celltype)
# before %
b=table(subdf_before$before_comp_ann.celltype)/sum(table(subdf_before$before_comp_ann.celltype))
c=(a-b)/b
c=as.data.frame(c)
colnames(c)=c('type','freq')
temp=table(subdf_aft$after_comp_ann.celltype)-table(subdf_before$before_comp_ann.celltype)
temp=as.data.frame(temp)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = freq*0.5)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = freq*0.5)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = c$freq)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = c$freq*2)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = 1)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = c$freq*10)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -c$freq*10)
c$freq>0
(c$freq>0)*10
c$freq/abs(c$freq)
(c$freq/abs(c$freq))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*10)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*5)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.2)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c("#999999", "#E69F00","#E69F00","#999999","#999999","#999999","#E69F00","#999999","#999999","#999999","#999999"))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c("#999999", "#E69F00","#E69F00","#999999","#999999","#999999","#E69F00","#999999","#999999","#999999","#999999"))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_color_manual(values=c("#999999", "#E69F00","#E69F00","#999999","#999999","#999999","#E69F00","#999999","#999999","#999999","#999999"))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_color_manual(values=c("#999999", "#E69F00","#E69F00","#999999","#999999","#999999","#E69F00","#999999","#999999","#999999","#999999"))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c("#999999", "#E69F00","#E69F00","#999999","#999999","#999999","#E69F00","#999999","#999999","#999999","#999999"))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c("#E69F00", "#E69F00","#E69F00","#999999","#999999","#999999","#E69F00","#999999","#999999","#999999","#999999"))
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_brewer(palette="Dark2")
ggplot(c, aes(x=type, y=freq))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999","#999999","#999999"))
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity") + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.1) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 4) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 1) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.85) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.95) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(legend.position = "none")+theme_bw()+
theme(text = element_text(size=20))
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+theme_bw()+
theme(text = element_text(size=20))theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+theme_bw()+
theme(text = element_text(size=20))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(text = element_text(size=20))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(text = element_text(size=10))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(text = element_text(size=15))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 90))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.9) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.7) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.7, position = position_dodge(width = 0.9)) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.7, position = position_dodge(width = 0.7)) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.7, position = position_dodge(width = 0.5)) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.7, position = position_dodge(width = 0.1)) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.7, position = position_dodge(width = 10)) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8, position = position_dodge(width = 10)) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ls
c$freq=c$freq*100
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-0.35,0.15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
#ylim(-0.35,0.15)
+scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
#ylim(-0.35,0.15)
+scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=temp$Freq,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-35,15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
View(temp)
temp$percent=temp$Freq/sum(table(subdf_before$before_comp_ann.celltype))
a=as.data.frame(a)
View(A)
View(a)
a$perc=a$Freq*100
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=a$perc,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-35,15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
a$perc=as.integer(a$perc)
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=a$perc,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-35,15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
a$perc=a$Freq*100
a$perc=round(a$perc, digits = 3)
a$perc=round(a$perc, digits = 1)
a$perc=as.character(a$perc)
a$perc <- lapply(a$perc, function(x) paste('%', x))
# after %
a=table(subdf_aft$after_comp_ann.celltype)/sum(table(subdf_aft$after_comp_ann.celltype))#-table(subdf_before$before_comp_ann.celltype)
a=as.data.frame(a)
a$perc=a$Freq*100
a$perc=round(a$perc, digits = 1)
a$perc=as.character(a$perc)
a$perc <- lapply(a$perc, function(x) paste(x,'%'))
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=a$perc,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-35,15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
b
a
d=a-b
d=as.data.frame(d)
d=a-b
# after %
a=table(subdf_aft$after_comp_ann.celltype)/sum(table(subdf_aft$after_comp_ann.celltype))#-table(subdf_before$before_comp_ann.celltype)
# before %
b=table(subdf_before$before_comp_ann.celltype)/sum(table(subdf_before$before_comp_ann.celltype))
d=a-b
d=as.data.frame(d)
d
d$perc=d$Freq*100
d$perc=round(d$perc, digits = 1)
d$perc=as.character(d$perc)
d$perc <- lapply(d$perc, function(x) paste(x,'%'))
d
ggplot(c, aes(x=type, y=freq, fill=type))+
geom_bar(stat = "identity", width = 0.8) + #
geom_text(aes( label=d$perc,y=freq), vjust = -(c$freq/abs(c$freq))*1.5)+
ylim(-35,15)+
scale_fill_manual(values=c('B'="#999999", 'CD4'="#E69F00",'CD8'="#E69F00",'DC'="#999999",'Endo'="#999999",'FDC'="#999999",'Lymphocyte'="#E69F00",'Macro'="#999999",'Monocyte_Neutrophil'="#999999",'NK'="#999999",'Other'="#999999"))+
ggtitle("CD3 channel compensation") +ylab("Cell Type Percentage Change")+
theme(text = element_text(size=15),axis.text.x = element_text(angle = 45, hjust=1))+theme(legend.position = "none")
ls
View(B_arc)
View(B_b4)
View(B_aft)
B_change=data.frame(B_aft$cellLabelInImage,B_aft[channel]-B_b4[channel])
View(B_change)
large=B_change$cellLabelInImage[B_change[channel]>=quantile(B_change[channel],0.999)]
channel='CD3'
B_change=data.frame(B_aft$cellLabelInImage,B_aft[channel]-B_b4[channel])
large=B_change$cellLabelInImage[B_change[channel]>=quantile(B_change[channel],0.999)]
quantile(B_change[channel],0.999)
B_change[channel]
clear
clear)_
clear()
quantile(B_change[channel],0.999)
t=B_change[channel]
large=B_change$cellLabelInImage[B_change[channel]>=quantile(t,0.999)]
large=B_change$cellLabelInImage[B_change[channel]>=quantile(B_change$CD3,0.999)]
View(large)
colnames(B_change)=c('id','value')
large=B_change$id[B_change$value>=quantile(B_change$value,0.999)]
View(large)
temp=data.frame(B_aft$cellLabelInImage,B_aft[channel]-B_b4[channel])
colnames(temp)=c('id','value')
large=temp$id[temp$value>=quantile(temp$value,0.999)]
small=temp$id[temp$value<=quantile(temp$value,0.001)]
View(small)
channel='CD20'
temp=data.frame(B_aft$cellLabelInImage,B_aft[channel]-B_b4[channel])
colnames(temp)=c('id','value')
large=temp$id[temp$value>=quantile(temp$value,0.999)]
small=temp$id[temp$value<=quantile(temp$value,0.001)]
large=temp$id[temp$value>=quantile(temp$value,0.995)]
channel='CD8a'
temp=data.frame(Tcells_aft$cellLabelInImage,Tcells_aft[channel]-Tcells_b4[channel])
colnames(temp)=c('id','value')
large=temp$id[temp$value>=quantile(temp$value,0.995)]
small=temp$id[temp$value<=quantile(temp$value,0.001)]
channel='CD20'
temp=data.frame(Tcells_aft$cellLabelInImage,Tcells_aft[channel]-Tcells_b4[channel])
colnames(temp)=c('id','value')
large=temp$id[temp$value>=quantile(temp$value,0.995)]
small=temp$id[temp$value<=quantile(temp$value,0.001)]
channel='CD11b'
ls
channel='CD11b'
temp=data.frame(Mphage_aft$cellLabelInImage,Mphage_aft[channel]-Mphage_b4[channel])
colnames(temp)=c('id','value')
large=temp$id[temp$value>=quantile(temp$value,0.995)]
small=temp$id[temp$value<=quantile(temp$value,0.001)]
channel='CD20'
large=temp$id[temp$value>=quantile(temp$value,0.995)]
small=temp$id[temp$value<=quantile(temp$value,0.001)]
channel='CD20'
channel='CD20'
temp=data.frame(Mphage_aft$cellLabelInImage,Mphage_aft[channel]-Mphage_b4[channel])
colnames(temp)=c('id','value')
large=temp$id[temp$value>=quantile(temp$value,0.995)]
small=temp$id[temp$value<=quantile(temp$value,0.001)]
View(temp)
channel='CD20'
temp=data.frame(Mphage_aft$cellLabelInImage,Mphage_aft[channel]-Mphage_b4[channel])
View(temp)
colnames(temp)=c('id','value')
large=temp$id[temp$value>=quantile(temp$value,0.995)]
small=temp$id[temp$value<=quantile(temp$value,0.001)]
View(large)
small=temp$id[temp$value<=quantile(temp$value,0.001)]
View(small)
# from + to zero
temp3=cbind(B_aft,B_b4)
View(temp3)
# from + to zero
temp3=cbind(B_aft[channel],B_b4[channel],B_b4$cellLabelInImage)
View(temp3)
colnames(temp3)=c("v1",'v2','v3')
temp2=subset(temp3,temp3$v1==0 & temp3$v2 > 0 )
View(temp2)
temp2=subset(temp3,temp3$v1>0 & temp3$v2 = 0 )
temp2=subset(temp3,temp3$v1>0 & temp3$v2 == 0 )
View(temp2)
temp2=subset(temp3,temp3$v1>0 & temp3$v2 == 0 )
View(temp2)
temp2=subset(temp3,temp3$v1==>0 & temp3$v2 == 0 )
temp2=subset(temp3,temp3$v1==0 & temp3$v2 == 0 )
View(temp2)
temp2=subset(temp3,temp3$v1>0 & temp3$v2 == 0 )
View(temp2)
channel='CD20'
# from + to zero
temp3=cbind(B_aft[channel],B_b4[channel],B_b4$cellLabelInImage)
colnames(temp3)=c("v1",'v2','v3')
temp2=subset(temp3,temp3$v1>0 & temp3$v2 == 0 )
View(temp2)
channel='CD3'
# from + to zero
temp3=cbind(B_aft[channel],B_b4[channel],B_b4$cellLabelInImage)
